<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <link rel="stylesheet" type="text/css" href="http://meyerweb.com/eric/tools/css/reset/reset.css" />
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css" />

    <script src="/javascripts/jquery.js"></script>
    <title>이미지 전송</title>
</head>
<body>
    <form method="post" action="/profile/photo"  enctype="multipart/form-data" name="uploadform">
        <input type="file" name="imagefile" id="imagefile"  onchange="handleFiles(this.files)">
    </form>
    <div class="preview"></div>
    <button>확인</button>
    <script>
        $("button").on("click", $.proxy(function(){
            console.log("aa");
            $("form").get(0).submit();
//            self.close();
        }, this));

    </script>
    <script>
    (function() {
        var inputElement = document.querySelector("#imagefile");
        inputElement.addEventListener("change", handleFiles, false);
    })();

    function handleFiles(files) {
        var preview = document.querySelector(".preview");
        if(files.length === 0) {
            preview.innerHTML = "";
            return;
        }
        
        for (var i = 0; i < files.length; i++) {
            var file = files[i];
            var imageType = /image.*/;

            if (!file.type.match(imageType)) {
                continue;
            }

            var img = document.createElement("img");
            img.classList.add("attachedImg");
            img.height = 200;
            img.file = file;
            preview.innerHTML="";
            preview.appendChild(img); // Assuming that "preview" is the div output where the content will be displayed.
            
            var reader = new FileReader();
            reader.onload = (function(aImg) {
                return function(e) {
                    aImg.src = e.target.result;
                };
            })(img);
            reader.readAsDataURL(file);
        }
    }
    </script>
</body>

</html>
