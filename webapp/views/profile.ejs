<!doctype html>
<html lang="ko">
<head>
    <title>NEXTIN profile</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link rel="stylesheet" href="/bower_components/bootstrap/dist/css/bootstrap.min.css"> <!-- load bootstrap css -->
    <link rel="stylesheet" href="/bower_components/components-font-awesome/css/font-awesome.min.css"> <!-- load fontawesome -->
    
    <style>
        body        { padding-top:80px; word-wrap:break-word; }
    </style>

    <!--주희가 추가한 것 -->
    <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/earlyaccess/nanumgothic.css" />
    <link rel="stylesheet" type="text/css" href="/stylesheets/main.css" />
    <script src="/javascripts/jquery.js"></script>
    <!-- 주희가 추가한 것 끝 -->

</head>
<body>
    <header>
    </header>
    <div id="wrapper">
        <!-- 개인 프로필 정보 -->
        <div class="col-sm-6 col-sm-offset-3">

        <section id="core_info" class="respond-form">
            <form class="form-horizontal" role="form" action="#">
            <div class="form-group">
                <label for="moto" class="col-sm-2 control-label">선언문</label>
                <div class="col-sm-10">
                    <input type="text" class="form-control" id="moto" name="moto" placeholder="선언문" value="">
                </div>
            </div>
            <div class="form-group">
                <label for="movieurl" class="col-sm-2 control-label">movie url</label>
                <div class="col-sm-10">
                    <input type="movieurl" class="form-control" id="movieurl" name="movieurl" placeholder="유투브 주소" value="">
                </div>
            </div>
            <div class="form-group">
                <label for="markdown" class="col-sm-2 control-label">자기소개</label>
                <div class="col-sm-10">
                    <textarea class="form-control" id="markdown" rows="10" name="markdown" placeholder="마크다운으로 자기소개를 작성해주세요."></textarea>
                </div>
            </div>
            
            <div class="form-group">
                <label for="photourl" class="col-sm-2 control-label">프로필 사진</label>
                <div class="col-sm-10 col-sm-offset-2">
                    <input class="imageInput fileupload form-control" type="button" name="photourl" accept="image/*" value="프로필 사진 업로드"/>
                    <div class="preview"></div>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                    <button id="submit" name="submit" type="submit" value="Send" class="btn btn-primary">send</button>
                </div>
            </div>

            <div class="form-group">
                <div class="col-sm-10 col-sm-offset-2">
                    <! Will be used to display an alert to the user>
                </div>
            </div>
        </form>




        </section>
    </div>
    <!-- //개인 프로필 정보 -->
    </div>
    <footer></footer>

    <script>
        var dataObject = <%-JSON.stringify(user) %>;

        var htInitData = {
                //userId : dataObject._id,
                photourl : dataObject.profile.photourl,
                moto : dataObject.profile.moto,
                movieurl: dataObject.profile.movieurl,
                markdown : dataObject.profile.markdown  
        }

        var profileHelper = {
            init: function(ht){
                this._initComponent();
                this._fillData(); 
                this.$elFileUpload.addEventListener("click", $.proxy(this._onClickFileUpload, this));
                this.$elProfileUpdateBtn.addEventListener("click", function(){
                    $.ajax({
                        url: "/profile",
                        type: "PUT",
                        data: $('#core_info form').serialize(),
                    }).success(function() {
                        alert("정상적으로 업로드되었습니다.");
                    });
                })
            },

            _onClickFileUpload : function(e){
                console.log("open");
                window.open("/img_upload_popup.html", "이미지 업로드", "fullscreen=no, width=500, height=500");
            },

            _initComponent: function() {
                this.$elRoot = document.querySelector("#core_info");
                this.$elProfileUpdateBtn = this.$elRoot.querySelector("#submit");
                this.$elPreview = this.$elRoot.querySelector(".preview");
                this.$elFileUpload = this.$elRoot.querySelector(".imageInput");
            },

            _fillData : function(){
                var htData = htInitData;
                if(!htData){
                    // 초기 사용자 데이터 없음
                    return ;
                }
                for (var i in htData){
                    var input = this.$elRoot.querySelector("#"+i);
                    if(i === "photourl"){
                        this._fillProfileImage(htData[i]);
                    } else {
                        input.value = htData[i];
                    }
                }
            },

            _fillProfileImage : function(imgUrl){
                var $preview = this.$elPreview;
                console.log(imgUrl);
                $preview.innerHTML = "<img class='fit' src=" + imgUrl + " height='200' >";
            },

            _getFormData: function(){
                var form = $('form')[0];
                return new FormData(form);
            }


        };

        $(document).ready(function () {
            profileHelper.init(htInitData);
        });
    </script>
    <script>
    //     var ImagePreview = function(ht){
    //         this.init(ht);
    //     };

    //     ImagePreview.prototype = {
    //         init : function(ht){
    //             this.$elFileUpload = $(ht.elFileUpload);
    //             this.$elPreview = $(ht.elPreview);
    //             // this.$elFileUpload.on("change", $.proxy(this._onChangeFileUpload, this));
    //         },

    //     var ProfileUpdate = function(ht){
    //         this.init(ht);
    //     };

    //     ProfileUpdate.prototype = {
    //         init : function(ht){
    //             this.option = ht;
    //             this.$elRoot = $(ht.elRoot);
    //             this.$elButton = $(ht.elButton);
    //             this._initComponent();
    //             this._fillData();
    //             this.$elButton.on("click", $.proxy(function(){
    //                 console.log("profile upload button clicked");
    //                 $.ajax({
    //                   type: "PUT",
    //                   url: "/profile",
    //                   data: $('#core_info form').serialize(),
    //                   success: function(data, textStatus, jqXHR) {
    //                     alert('everything was OK');
    //                   }
    //                 });
    //             }));
    //         },

    //         _initComponent : function(){
    //             new ImagePreview({
    //                 elFileUpload : $(".fileupload"),
    //                 elPreview : $(".preview")
    //             });
    //         },

    //         _fillData : function(){
    //             var htData = htInitData;
    //             if(!htData){
    //                 // 초기 사용자 데이터 없음
    //                 return ;
    //             }
    //             for (var i in htData){
    //                 var input = this.$elRoot.find("[name=" + i + "]");
    //                 if(i === "photourl"){
    //                     this._fillProfileImage(htData[i]);
    //                 } else {
    //                     input.val(htData[i]);
    //                 }
    //             }
    //         },

    //         _fillProfileImage : function(imgUrl){
    //             var $preview = this.$elRoot.find(".preview");
    //             console.log(imgUrl);
    //             $preview.html("<img class='fit' src=" + imgUrl + ">");
    //         }
    //     };

    // 
    </script>
</body>
</html>
